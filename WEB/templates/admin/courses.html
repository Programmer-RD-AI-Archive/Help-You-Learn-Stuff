{% extends "/admin/base.html" %} {% block head %}

<title>Courses</title>

{% endblock %} {% block body %}
<div class="container">
  <div
    class="content"
    id="content"
    style="resize: both; overflow: auto; height: 250px"
  ></div>
  <hr />
  <br />
  <form>
    <div class="mb-3">
      <label for="Marks Required to Pass" class="form-label"
        >Marks Required to Pass</label
      >
      <input
        type="number"
        class="form-control"
        id="Marks Required to Pass"
        required
      />
    </div>
    <div style="resize: both; overflow: auto; height: 125px">
      {% for resource in resources %}
      <br />
      <button
        type="button"
        id="{{resource[0]}}"
        value="{{resource[3]}},{{resource[0]}},resource"
        class="btn btn-dark"
        onclick="add_to_content(this.value)"
      >
        {{resource[3]}}
      </button>
      <br />
      {% endfor %}
    </div>
    <br />
    <hr />
    <br />
    <div style="resize: both; overflow: auto; height: 125px">
      {% for question in questions %}
      <button
        type="button"
        id="{{question[0]}}"
        value="{{question[2]}},{{question[0]}},question"
        class="btn btn-dark"
        onclick="add_to_content(this.value)"
      >
        {{question[2]}}
      </button>
      {% endfor %}
    </div>
    <br />
    <button type="submit" id="submit_btn" class="btn btn-primary">
      Submit
    </button>
  </form>
</div>
<script>
  var idx = 0;
  var idx_val = {};
  function removeElement(idx) {
    console.log(idx);
    var element = document.getElementById(`${idx}`);
    element.remove();
  }
  function add_to_content(val) {
    val = val.split(",");
    idx += 1;
    idx_val[idx] = val;
    document.getElementById("content").insertAdjacentHTML(
      "beforeend",
      `<div id="${idx}" class="${idx}" style="background-color:lightgray; padding:12.5px; margin:12.5px; border-radius: 25px">
        <h4>${val[0]}</h4>
        <p>${val[2]}</p>
        <button type="button" class="btn btn-outline-danger" onclick='removeElement("${idx}");'>Delete</button>
      </div>`
    );
    console.log(val);
  }
  var marks = document.getElementById(`Marks Required to Pass`).value;
  $("#submit_btn").click(function (e) {
    whole_content = $("#content").html();
    var info = {};
    for (idx_iter = 1; idx_iter <= idx; idx_iter++) {
      var specific_content = $(`#${idx_iter}`).html();
      console.log(specific_content);
      info[idx_iter] = [specific_content, idx_val[idx_iter]];
    }
    console.log(whole_content);
    $.ajax({
      type: "POST",
      url: "/Admin/Courses/Post/",
      data: JSON.stringify({
        info: info,
        whole_content: whole_content,
        marks: marks,
      }),
    });
    alert("Course Added");
    window.location.reload(0);
  });
</script>
{% endblock %}
